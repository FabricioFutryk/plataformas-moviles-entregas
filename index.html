<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <title>Futryk Fabricio - Entregas</title>
  </head>
  <body>
    <div>
      <h1>Trabajos</h1>

      <ul id="container"></ul>
    </div>

    <script>
      let container = document.getElementById("container");
      const apiLink =
        "https://api.github.com/repos/futrykfabricio/plataformas-moviles-entregas/git/trees/master";
      const rawLink =
        "https://raw.githubusercontent.com/futrykfabricio/plataformas-moviles-entregas/master/";

      const getTasks = async () => {
        let res = await axios.get(apiLink);
        const tree = res.data.tree;

        if (!tree) return;

        tree.forEach(async (dir) => {
          if (dir.type === "tree") {
            let readmeLink = rawLink + `${dir.path}/README.md`;
            let readmeResponse = await axios.get(readmeLink);

            if (!readmeResponse) return;

            const readmeContent = readmeResponse.data;

            let li = document.createElement("li");
            let a = document.createElement("a");

            let title = readmeContent.split("\n").shift().replace("# ", "");

            let date = readmeContent.split("\n")[2].replace("# ", "");

            a.innerHTML += `${dir.path.toUpperCase()} | ${title} | ${date}`;
            a.href = `./${dir.path}`;

            li.appendChild(a);
            container.appendChild(li);
          }
        });
      };

      getTasks();
    </script>
  </body>
</html>
